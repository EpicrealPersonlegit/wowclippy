local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Remotes
local moneyRemote = ReplicatedStorage:WaitForChild("MoneyRemote")
local bankRemote = ReplicatedStorage:WaitForChild("BankRemote")

-- UI References (Adjust names if they differ in your Explorer)
local moneyLabel = playerGui:WaitForChild("money"):WaitForChild("TextLabel")
local atmFrame = playerGui:WaitForChild("atm"):WaitForChild("Frame")

local depositBtn = atmFrame:WaitForChild("deposit")
local withdrawBtn = atmFrame:WaitForChild("withdraw")
local transferBtn = atmFrame:WaitForChild("transfer")
local amountBox = atmFrame:WaitForChild("amount")
local playerNameBox = atmFrame:WaitForChild("playername")
local bankDisplay = atmFrame:FindFirstChild("bankBalance") -- Optional: If you have a label inside ATM showing bank balance

-- Formatting
local function formatCurrency(amount)
	return amount >= 1000 and string.format("%.1fk", amount / 1000) or tostring(amount)
end

local function showNotify(msg, isErr)
	StarterGui:SetCore("ChatMakeSystemMessage", {
		Text = "[BANK]: " .. msg,
		Color = isErr and Color3.new(1, 0.3, 0.3) or Color3.new(0.3, 1, 0.3),
		Font = Enum.Font.SourceSansBold
	})
end

-- Update Listeners
moneyRemote.OnClientEvent:Connect(function(action, val)
	if action == "UpdateMoney" then
		moneyLabel.Text = formatCurrency(val) .. " CCRP"
	elseif action == "UpdateBank" and bankDisplay then
		bankDisplay.Text = "Bank: $" .. val
	end
end)

bankRemote.OnClientEvent:Connect(function(action, msg)
	showNotify(msg, action == "Error")
	if action == "Success" then
		amountBox.Text = ""
		playerNameBox.Text = ""
	end
end)

-- Button Logic
depositBtn.MouseButton1Click:Connect(function()
	local amt = tonumber(amountBox.Text)
	if amt then bankRemote:FireServer("Deposit", amt) end
end)

withdrawBtn.MouseButton1Click:Connect(function()
	local amt = tonumber(amountBox.Text)
	if amt then bankRemote:FireServer("Withdraw", amt) end
end)

transferBtn.MouseButton1Click:Connect(function()
	local amt = tonumber(amountBox.Text)
	local target = playerNameBox.Text
	if amt and #target > 0 then
		bankRemote:FireServer("Transfer", amt, target)
	else
		showNotify("Enter amount and player name!", true)
	end
end)

-- Initial Request
moneyRemote:FireServer("RequestMoney")