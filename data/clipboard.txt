local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local gui = script.Parent
local mainFrame = gui:WaitForChild("MainFrame")

local scrollFrame = mainFrame:WaitForChild("PlayerList")
local selectedLabel = mainFrame:WaitForChild("SelectedLabel")
local amountBox = mainFrame:WaitForChild("AmountBox")
local giveButton = mainFrame:WaitForChild("GiveButton")

local AdminRemote = ReplicatedStorage:WaitForChild("AdminMoneyRemote")

local currentlySelectedPlayer = nil

--// FUNCTION: Refresh the Player List
local function updatePlayerList()
	-- Clear existing buttons
	for _, child in pairs(scrollFrame:GetChildren()) do
		if child:IsA("TextButton") then child:Destroy() end
	end

	-- Create new buttons for each player
	for _, p in pairs(Players:GetPlayers()) do
		local btn = Instance.new("TextButton")
		btn.Name = p.Name
		btn.Text = p.Name
		btn.Size = UDim2.new(1, 0, 0, 30)
		btn.Parent = scrollFrame
		
		-- When you click a name in the list
		btn.MouseButton1Click:Connect(function()
			currentlySelectedPlayer = p.Name
			selectedLabel.Text = "Fetching data..."
			-- Ask server for this player's stats
			AdminRemote:FireServer("GetInfo", p.Name)
		end)
	end
end

--// LISTENERS
-- 1. Refresh list when players join/leave
Players.PlayerAdded:Connect(updatePlayerList)
Players.PlayerRemoving:Connect(updatePlayerList)
updatePlayerList() -- Run once at start

-- 2. Handle Server Responses
AdminRemote.OnClientEvent:Connect(function(action, arg1, arg2)
	if action == "UpdateInfo" then
		-- arg1 = Name, arg2 = Money
		local name = arg1
		local money = arg2
		if currentlySelectedPlayer == name then
			selectedLabel.Text = "Player: " .. name .. " | Cash: $" .. money
		end
		
	elseif action == "Success" then
		-- Optional: Make the button green for a second
		giveButton.Text = "Success!"
		task.wait(1)
		giveButton.Text = "Give Money"
	end
end)

-- 3. Give Button Logic
giveButton.MouseButton1Click:Connect(function()
	if not currentlySelectedPlayer then
		selectedLabel.Text = "Select a player first!"
		return
	end
	
	local amount = tonumber(amountBox.Text)
	if amount then
		-- Fire the server to give money
		AdminRemote:FireServer("GiveMoney", currentlySelectedPlayer, amount)
	else
		amountBox.Text = "Invalid Num"
	end
end)