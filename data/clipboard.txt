local ReplicatedStorage = game:GetService("ReplicatedStorage")
local MarketplaceService = game:GetService("MarketplaceService")
local EquipEvent = Instance.new("RemoteEvent")
EquipEvent.Name = "EquipAssetEvent"
EquipEvent.Parent = ReplicatedStorage

-- Map Asset Types to HumanoidDescription properties
local TYPE_MAP = {
	[8] = "Hat", [11] = "Shirt", [12] = "Pants", [18] = "Face",
	[41] = "HairAccessory", [42] = "FaceAccessory", [43] = "NeckAccessory",
	[44] = "ShoulderAccessory", [45] = "FrontAccessory", [46] = "BackAccessory", [47] = "WaistAccessory",
	[64] = "JacketAccessory", [65] = "SweaterAccessory", [67] = "LeftShoeAccessory", [68] = "RightShoeAccessory"
}

EquipEvent.OnServerEvent:Connect(function(player, assetId, action)
	local char = player.Character
	local hum = char and char:FindFirstChildOfClass("Humanoid")
	if not hum then return end

	local description = hum:GetAppliedDescription()
	
	if action == "Equip" then
		local success, info = pcall(function() return MarketplaceService:GetProductInfo(assetId) end)
		if success and info then
			local prop = TYPE_MAP[info.AssetTypeId]
			if prop then
				if prop:find("Accessory") then
					-- Add to existing accessories
					local accs = description:GetAccessories(true)
					table.insert(accs, {AssetId = assetId, Order = #accs + 1, AccessoryType = Enum.AccessoryType.Unknown})
					description:SetAccessories(accs, true)
				else
					-- Swap clothing/face
					description[prop] = assetId
				end
			end
		end
	elseif action == "Unequip" then
		-- Remove accessory from list
		local accs = description:GetAccessories(true)
		for i, data in pairs(accs) do
			if data.AssetId == assetId then
				table.remove(accs, i)
				break
			end
		end
		description:SetAccessories(accs, true)
	end
	
	-- Apply the changes to the character
	local applySuccess, err = pcall(function() hum:ApplyDescription(description) end)
	if not applySuccess then warn("Server Error: " .. err) end
end)
